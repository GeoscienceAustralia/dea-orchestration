dist: trusty
# tests primarily focused on lambda component
language: python
python:
  - "3.6"
sudo: false
addons:
  apt:
    packages:
      - shellcheck

env:
  global:
    - DEA_ENVIRONMENT='test'

git:
  depth: 99999


cache:
  directories:
    - $HOME/.cache/pip

install:
  - pip install -r requirements.txt
  - ./scripts/install_script all

script:
  - npm install -g serverless
  - ./scripts/check-code.sh


deploy:
   provider: script
   script:
     # Serverless deploy to production environment after merging to production branch
     - if [ "$TRAVIS_PULL_REQUEST" == "false" ]
       then
          cd lambda_functions/execute_ssh_command_js/
          npm install
          sls deploy -v -s prod
       else
          echo "Skip deploy"
       fi
   skip_cleanup: true
   on:
     branch: production
